<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Meta Bank – Verification Center</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin:0; font-family:'Segoe UI',sans-serif;
      background-color:#f4f6f9; display:flex; min-height:100vh;
    }
    .sidebar {
      width:250px; background-color:#006644; color:white;
      height:100vh; padding:20px; position:fixed; left:0; top:0;
    }
    .sidebar h2 { margin:0 0 30px; font-size:1.5em; text-align:center; }
    .sidebar a {
      display:block; color:white; text-decoration:none; margin-bottom:15px;
      font-weight:500; padding:10px 15px; border-radius:6px; transition:background-color 0.3s;
    }
    .sidebar a:hover { background-color:#004d33; }
    .sidebar a.active { background-color:#004d33; }
    .main {
      flex:1; padding:30px; background:linear-gradient(to bottom right,#ffffff,#e0f7e9);
      margin-left:250px; width:calc(100% - 250px);
    }
    .greeting { font-size:1.4em; margin-bottom:20px; color:#006644; font-weight:600; }
    .card {
      background:#fff; padding:25px; border-radius:12px;
      box-shadow:0 5px 15px rgba(0,0,0,0.1); margin-bottom:24px; max-width:700px;
    }
    h3 { margin:0 0 20px; color:#006644; font-size:1.3em; }
    label { display:block; margin-top:12px; font-weight:bold; color:#333; }
    input[type="file"] {
      margin-top:6px; width:100%; padding:10px; border:2px solid #e1e5e9;
      border-radius:6px; background:#f8f9fa;
    }
    button {
      margin-top:18px; background:#006644; color:white; border:none;
      padding:12px 20px; border-radius:6px; cursor:pointer; font-size:16px; font-weight:600;
      transition:background-color 0.3s;
    }
    button:hover { background:#004d33; }
    button:disabled { background-color:#ccc; cursor:not-allowed; }
    .status-line {
      font-size:1em; margin:12px 0; padding:10px 15px; background:#f8f9fa;
      border-radius:6px; border-left:4px solid #006644;
    }
    .status-label { font-weight:600; color:#333; }
    .status-value { color:#006644; font-weight:500; }
    .alert { padding:12px 15px; border-radius:6px; margin-bottom:20px; text-align:center; font-weight:500; display:none; }
    .alert-success { background:#e8f8ef; color:#006644; border:1px solid #b8e6b8; }
    .alert-error { background:#ffeaea; color:#d63031; border:1px solid #ffcccc; }
    .loading { display:inline-block; width:20px; height:20px; border:3px solid #fff; border-radius:50%; border-top-color:transparent; animation:spin 1s ease-in-out infinite; margin-right:10px; }
    @keyframes spin { to { transform:rotate(360deg);} }
    .file-input {
      padding:15px; background:#f8f9fa; border:2px dashed #dee2e6; border-radius:6px;
      text-align:center; cursor:pointer; transition:border-color 0.3s; margin-top:8px;
    }
    .file-input:hover { border-color:#006644; }
    .file-input input { display:none; }
    .file-input label { cursor:pointer; margin:0; color:#666; }
    .file-name { margin-top:8px; font-size:14px; color:#006644; font-weight:500; }
  </style>
</head>
<body>
<div class="sidebar">
  <h2>Meta Bank</h2>
  <a href="dashboard.html">Dashboard</a>
  <a href="overview.html">Overview</a>
  <a href="verification.html" class="active">Verification</a>
  <a href="profile.html">Profile</a>
  <a href="loan.html">Loans</a>
  <a href="investments.html">Investments</a>
  <a href="ira.html">IRA</a>
  <a href="transfer.html">Transfer</a>
  <a href="external-accounts.html">External Accounts</a>
  <a href="statements.html">Statements</a>
  <a href="business-account.html">Business Account</a>
  <a href="#" id="signOutLink">Sign Out</a>
</div>

<div class="main">
  <div class="greeting">Verification Center</div>
  <div id="alertMessage" class="alert"></div>

  <div class="card">
    <h3>KYC Status</h3>
    <div class="status-line"><span class="status-label">Status:</span> <span class="status-value" id="kycStatus">Loading...</span></div>
    <div class="status-line"><span class="status-label">Account Status:</span> <span class="status-value" id="acctStatus">Loading...</span></div>
    <div class="status-line"><span class="status-label">Email Verification:</span> <span class="status-value" id="emailStatus">Loading...</span></div>
  </div>

  <div class="card">
    <h3>Upload Verification Documents</h3>
    <form id="kycForm">
      <label>ID Front</label>
      <div class="file-input">
        <input type="file" id="idFront" accept="image/*" required>
        <label>Click to upload ID Front (JPG, PNG)</label>
        <div class="file-name" id="idFrontName"></div>
      </div>
      <label>ID Back</label>
      <div class="file-input">
        <input type="file" id="idBack" accept="image/*" required>
        <label>Click to upload ID Back (JPG, PNG)</label>
        <div class="file-name" id="idBackName"></div>
      </div>
      <button type="submit" id="submitButton">
        <span id="buttonText">Submit Documents</span>
        <span id="buttonSpinner" class="loading" style="display:none;"></span>
      </button>
    </form>
  </div>
</div>

<script>
const API_BASE =
  (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')
    ? 'http://localhost:5000/api'
    : 'https://meta-bank-backend.onrender.com/api';

const token=localStorage.getItem('metaBankToken');
if(!token){alert('Session expired. Please log in again.');location.href='login.html';}

function showAlert(message,type='error'){
  const el=document.getElementById('alertMessage');
  el.textContent=message; el.className=`alert alert-${type}`; el.style.display='block';
  if(type==='success') setTimeout(()=>el.style.display='none',4000);
}
function setLoading(isLoading){
  const btn=document.getElementById('submitButton');
  const txt=document.getElementById('buttonText');
  const spin=document.getElementById('buttonSpinner');
  if(isLoading){btn.disabled=true;txt.textContent='Uploading...';spin.style.display='inline-block';}
  else{btn.disabled=false;txt.textContent='Submit Documents';spin.style.display='none';}
}

async function loadVerification(){
  try{
    const res=await fetch(`${API_BASE}/user/verification`,{headers:{'Authorization':'Bearer '+token}});
    const data=await res.json();
    if(res.ok&&data.success){
      document.getElementById('kycStatus').textContent=data.verification?.kycStatus||'pending';
      document.getElementById('acctStatus').textContent=data.verification?.accountStatus||'inactive';
      document.getElementById('emailStatus').textContent=data.verification?.isVerified?'Verified':'Pending';
    }else{showAlert(data.message||'Failed to load verification status');}
  }catch(err){console.error(err);showAlert('Error connecting to server');}
}

    const formData = new FormData();
    formData.append('idFront', idFrontFile);
    formData.append('idBack', idBackFile);

    const res = await fetch(`${API_BASE}/user/kyc/upload`, {
      method: 'POST',
      headers: { 'Authorization': 'Bearer ' + token },
      body: formData
    });
    const data = await res.json();

    if (res.ok && data.success) {
      showAlert('✅ Documents uploaded successfully! Your KYC is now pending review.', 'success');
      loadVerification();
    } else {
      showAlert(data.message || 'Failed to upload documents');
    }
  } catch (err) {
    console.error('KYC upload error:', err);
    showAlert('Error connecting to server');
  } finally {
    setLoading(false);
  }
});

// Update file input labels
document.querySelectorAll('input[type="file"]').forEach(input => {
  input.addEventListener('change', function() {
    const fileNameEl = this.parentElement.querySelector('.file-name');
    fileNameEl.textContent = this.files.length > 0 ? this.files[0].name : '';
  });
});

// Sign out
document.getElementById('signOutLink').addEventListener('click', e => {
  e.preventDefault();
  localStorage.clear();
  location.href = 'login.html';
});

// Load verification status on page ready
document.addEventListener('DOMContentLoaded', loadVerification);
</script>

</body>
</html>
