<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Meta Bank – KYC Upload</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin:0;
      font-family:'Segoe UI',sans-serif;
      background-color:#f4f6f9;
      display:flex;
      min-height:100vh;
    }
    .sidebar {
      width:250px;
      background-color:#006644;
      color:white;
      height:100vh;
      padding:20px;
      box-sizing:border-box;
      position:fixed;
      left:0;
      top:0;
    }
    .sidebar h2 {
      margin-top:0;
      font-size:1.5em;
      margin-bottom:30px;
      text-align:center;
    }
    .sidebar a {
      display:block;
      color:white;
      text-decoration:none;
      margin-bottom:15px;
      font-weight:500;
      padding:10px 15px;
      border-radius:6px;
      transition:background-color 0.3s;
    }
    .sidebar a:hover { background-color:#004d33; text-decoration:none; }
    .sidebar a.active { background-color:#004d33; }

    .main {
      flex:1;
      padding:30px;
      background:linear-gradient(to bottom right,#ffffff,#e0f7e9);
      margin-left:250px;
      width:calc(100% - 250px);
    }
    .greeting {
      font-size:1.4em;
      margin-bottom:20px;
      color:#006644;
      font-weight:600;
    }
    .kyc-card {
      background-color:white;
      padding:25px;
      border-radius:12px;
      box-shadow:0 5px 15px rgba(0,0,0,0.1);
      max-width:700px;
    }
    .kyc-card h3 {
      margin-top:0;
      color:#006644;
      font-size:1.3em;
      margin-bottom:20px;
    }
    .form-group { margin-bottom:15px; }
    label { display:block; margin-bottom:6px; font-weight:500; }
    input[type="file"] {
      width:100%;
      padding:10px;
      border:1px solid #ccc;
      border-radius:6px;
    }
    button {
      margin-top:15px;
      background-color:#006644;
      color:white;
      padding:12px 24px;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-size:16px;
      font-weight:600;
      transition:background-color 0.3s;
    }
    button:hover { background-color:#004d33; }
    .alert {
      padding:12px 15px;
      border-radius:6px;
      margin-bottom:20px;
      text-align:center;
      font-weight:500;
      display:none;
    }
    .alert-success { background:#e8f8ef; color:#006644; border:1px solid #b8e6b8; }
    .alert-error { background:#ffeaea; color:#d63031; border:1px solid #ffcccc; }
  </style>
</head>
<body>

<div class="sidebar">
  <h2>Meta Bank</h2>
  <a href="dashboard.html">Dashboard</a>
  <a href="overview.html">Overview</a>
  <a href="verification.html">Verification</a>
  <a href="profile.html">Profile</a>
  <a href="loan.html">Loans</a>
  <a href="investments.html">Investments</a>
  <a href="ira.html">IRA</a>
  <a href="transfer.html">Transfer</a>
  <a href="external-accounts.html">External Accounts</a>
  <a href="statements.html">Statements</a>
  <a href="business-account.html">Business Account</a>
  <a href="kycupload.html" class="active">KYC Upload</a>
  <a href="#" id="signOutLink">Sign Out</a>
</div>

<div class="main">
  <div class="greeting">Upload your KYC documents</div>
  <div id="alertMessage" class="alert"></div>

  <div class="kyc-card">
    <h3>KYC Verification</h3>
    <form id="kycForm" enctype="multipart/form-data">
      <div class="form-group">
        <label for="idFront">Upload ID Front</label>
        <input type="file" id="idFront" name="idFront" accept="image/*" required>
      </div>
      <div class="form-group">
        <label for="idBack">Upload ID Back</label>
        <input type="file" id="idBack" name="idBack" accept="image/*" required>
      </div>
      <button type="submit">Submit KYC</button>
    </form>
  </div>
</div>

<script>
const API_BASE =
  (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')
    ? 'http://localhost:5000/api'
    : 'https://meta-bank-backend.onrender.com/api';

function showAlert(message, type = 'error') {
  const el = document.getElementById('alertMessage');
  el.textContent = message;
  el.className = `alert alert-${type}`;
  el.style.display = 'block';
  if (type === 'success') setTimeout(() => el.style.display = 'none', 4000);
}

document.getElementById('signOutLink').addEventListener('click', e => {
  e.preventDefault();
  localStorage.clear();
  window.location.href = 'login.html';
});

document.getElementById('kycForm').addEventListener('submit', async e => {
  e.preventDefault();
  const token = localStorage.getItem('metaBankToken');
  if (!token) {
    showAlert('Session expired. Please log in again.');
    setTimeout(() => window.location.href = 'login.html', 1500);
    return;
  }

  const idFrontFile = document.getElementById('idFront').files[0];
  const idBackFile = document.getElementById('idBack').files[0];
  if (!idFrontFile || !idBackFile) {
    showAlert('Please upload both front and back of your ID');
    return;
  }

  // ✅ File size check (5MB max)
  const maxSize = 5 * 1024 * 1024;
  if (idFrontFile.size > maxSize || idBackFile.size > maxSize) {
    showAlert('File size must be less than 5MB');
    return;
  }

  const formData = new FormData();
  formData.append('idFront', idFrontFile);
  formData.append('idBack', idBackFile);

  try {
    const res = await fetch(`${API_BASE}/user/kyc/upload`, {
      method: 'POST',
      headers: { 'Authorization': 'Bearer ' + token },
      body: formData
    });
    const data = await res.json();
    if (res.ok && data.success) {
      showAlert('✅ KYC documents uploaded successfully!', 'success');
      document.getElementById('kycForm').reset();
    } else {
      showAlert(data.message || 'Failed to upload KYC documents');
    }
  } catch (err) {
    console.error('KYC upload error:', err);
    showAlert('Error connecting to server');
  }
});
</script>

</body>
</html>
