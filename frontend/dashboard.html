<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Meta Bank Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f6f9;
      display: flex;
    }

    .sidebar {
      width: 250px;
      background-color: #006644;
      color: white;
      height: 100vh;
      padding: 20px;
      box-sizing: border-box;
    }

    .sidebar h2 {
      margin-top: 0;
      font-size: 1.5em;
      margin-bottom: 30px;
    }

    .sidebar a {
      display: block;
      color: white;
      text-decoration: none;
      margin-bottom: 15px;
      font-weight: 500;
    }

    .sidebar a:hover {
      text-decoration: underline;
    }

    .main {
      flex: 1;
      padding: 30px;
      background: linear-gradient(to bottom right, #ffffff, #e0f7e9);
    }

    .greeting {
      font-size: 1.4em;
      margin-bottom: 5px;
      color: #006644;
    }

    .welcome {
      font-size: 1em;
      margin-bottom: 10px;
      color: #333;
    }

    .total-balance {
      font-size: 1.2em;
      color: #006644;
      margin-bottom: 20px;
    }

    .account-info, .transactions, .transfers, .analytics {
      background-color: white;
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }

    .account-info h3, .transactions h3, .transfers h3, .analytics h3 {
      margin-top: 0;
      color: #006644;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }

    th {
      background-color: #e0f7e9;
      color: #006644;
    }

    .restriction-note {
      font-size: 0.9em;
      color: #888;
      margin-top: 8px;
    }

    .flex-row {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
    }

    .analytics {
      flex: 1;
      min-width: 300px;
    }

    .transfers {
      flex: 2;
      min-width: 400px;
    }

    .analytics p {
      margin: 8px 0;
      font-size: 0.95em;
    }

    canvas {
      margin-top: 20px;
    }
  </style>
</head>
<body>

<div class="sidebar">
  <h2>Meta Bank</h2>
  <a href="#">Overview</a>
  <a href="#">Verification</a>
  <a href="#">Profile</a>
  <a href="#">Loans</a>
  <a href="#">Investments</a>
  <a href="#">Transfer</a>
  <a href="#">External Accounts</a>
  <a href="#">Statements</a>
  <a href="#">Sign Out</a>
</div>

<div class="main">
  <div class="greeting">Good Afternoon, Micheal!</div>
  <div class="welcome">Welcome back to your dashboard. Hereâ€™s a quick look at your account activity.</div>
  <div class="total-balance"><strong>Total Balance:</strong> $1,250,000.00</div>

  <div class="account-info">
    <h3>Your Accounts</h3>
    <table id="accountTable">
      <tr>
        <th>Account Type</th>
        <th>Bank</th>
        <th>Account Number</th>
        <th>Routing Number</th>
        <th>Balance</th>
        <th>Available Balance</th>
      </tr>
      <tr>
        <td>Checking</td>
        <td>Meta Bank</td>
        <td>**** 9281</td>
        <td>1100001</td>
        <td>$1,250,000.00</td>
        <td>$1,248,500.00 ðŸ”’</td>
      </tr>
    </table>
    <div class="restriction-note">ðŸ”’ Available Balance is restricted due to pending verification or transfer limits.</div>
  </div>

  <div class="transactions">
    <h3>Recent Transactions</h3>
    <table>
      <tr>
        <th>Date</th>
        <th>Description</th>
        <th>Type</th>
        <th>Amount</th>
      </tr>
      <tr><td>Nov 2, 2025</td><td>Transfer domestic: Here</td><td>Withdrawal</td><td>-$20,000.00</td></tr>
      <tr><td>Oct 30, 2025</td><td>Transfer domestic: D</td><td>Withdrawal</td><td>-$1,000.00</td></tr>
      <tr><td>Oct 29, 2025</td><td>Loan disbursement - business</td><td>Deposit</td><td>+$200,000.00</td></tr>
    </table>
  </div>

  <div class="flex-row">
    <div class="transfers">
      <h3>Scheduled Transfers</h3>
      <table>
        <tr>
          <th>Date</th>
          <th>Type</th>
          <th>Description</th>
          <th>Amount</th>
          <th>Status</th>
        </tr>
        <tr><td>Nov 4, 2025</td><td>Domestic Transfer</td><td>H</td><td>$19,820.00</td><td>SUBMITTED</td></tr>
        <tr><td>Nov 3, 2025</td><td>Domestic Transfer</td><td>Here</td><td>$20,000.00</td><td>PROCESSING</td></tr>
      </table>
    </div>

    <div class="analytics">
      <h3>Bank Analytics</h3>
      <p><strong>Total Deposits:</strong> $206,500.00</p>
      <p><strong>Total Withdrawals:</strong> $148,800.00</p>
      <p><strong>Net Growth:</strong> +$57,700.00</p>
      <p><strong>Last Login:</strong> Nov 9, 2025, 2:52 PM</p>
      <canvas id="analyticsChart" width="300" height="200"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('analyticsChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Deposits', 'Withdrawals', 'Net Growth'],
      datasets: [{
        label: 'Bank Analytics ($)',
        data: [206500, 148800, 57700],
        backgroundColor: ['#009933', '#cc0000', '#0066cc']
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        title: {
          display: true,
          text: 'Bank Analytics Overview'
        }
      },
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

  async function loadDashboard() {
  const token = localStorage.getItem('metaBankToken');
  if (!token) {
    alert('Session expired. Please log in again.');
    window.location.href = 'login.html';
    return;
  }

  try {
    const res = await fetch('https://meta-bank-backend.onrender.com/api/user/profile', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      }
    });

    const data = await res.json();

    if (res.ok) {
      document.querySelector('.greeting').textContent = `Good Afternoon, ${data.username || 'Micheal'}!`;

      const row = `
        <tr>
          <td>${data.accountType || 'Checking'}</td>
          <td>${data.bankName || 'Meta Bank'}</td>
          <td>${data.accountNumber || '**** 9281'}</td>
          <td>${data.routingNumber || '1100001'}</td>
          <td>$${(data.balance || 1250000).toLocaleString()} ðŸ”’</td>
          <td>$${(data.availableBalance || 1248500).toLocaleString()} ðŸ”’</td>
        </tr>
      `;

      const table = document.getElementById('accountTable');
      table.innerHTML = `
        <tr>
          <th>Account Type</th>
          <th>Bank</th>
          <th>Account Number</th>
          <th>Routing Number</th>
          <th>Balance</th>
          <th>Available Balance</th>
        </tr>
        ${row}
      `;

      const note = document.createElement('div');
      note.className = 'restriction-note';
      note.textContent = 'ðŸ”’ Available Balance is restricted due to pending verification or transfer limits.';
      table.parentElement.appendChild(note);
    } else {
      alert(data.message || 'Failed to load dashboard');
    }
  } catch (err) {
    alert('Error connecting to server');
  }
}

  window.addEventListener('DOMContentLoaded', loadDashboard);
</script>

</body>
</html>
