<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Meta Bank Admin Portal</title>
  <style>
    * { box-sizing: border-box; }
    body { margin:0; font-family:'Segoe UI',sans-serif; background:#f4f6f9; display:flex; min-height:100vh; }
    .sidebar { width:250px; background:#003322; color:white; height:100vh; padding:20px; position:fixed; left:0; top:0; }
    .sidebar h2 { margin:0 0 30px; font-size:1.5em; text-align:center; }
    .sidebar a { display:block; color:white; text-decoration:none; margin-bottom:15px; font-weight:500; padding:10px 15px; border-radius:6px; transition:background-color 0.3s; }
    .sidebar a:hover, .sidebar a.active { background:#002211; }
    .main { flex:1; padding:30px; background:linear-gradient(to bottom right,#ffffff,#e0f7e9); margin-left:250px; width:calc(100% - 250px); overflow-x:auto; }
    .greeting { font-size:1.8em; margin-bottom:20px; color:#003322; font-weight:600; }
    .panel { background:white; padding:25px; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.1); margin-bottom:30px; }
    .panel h3 { margin:0 0 20px; color:#003322; font-size:1.3em; border-bottom:2px solid #e0f7e9; padding-bottom:10px; }
    .panel table { width:100%; border-collapse:collapse; margin-top:10px; }
    .panel th,.panel td { padding:12px 15px; border-bottom:1px solid #eee; text-align:left; }
    .panel th { background:#e0f7e9; color:#003322; font-weight:600; }
    .empty-state { text-align:center; padding:20px; color:#666; }
    .alert { padding:12px 15px; border-radius:6px; margin-bottom:20px; text-align:center; font-weight:500; display:none; }
    .alert-success { background:#e8f8ef; color:#006644; border:1px solid #b8e6b8; }
    .alert-error { background:#ffeaea; color:#d63031; border:1px solid #ffcccc; }
    input,button { margin:5px 0; padding:10px; border-radius:6px; font-size:14px; }
    input { border:1px solid #ccc; width:100%; }
    button { background:#006644; color:white; border:none; cursor:pointer; font-weight:600; }
    button:hover { opacity:0.9; }
  </style>
</head>
<body>

<div class="sidebar">
  <h2>Admin Portal</h2>
  <a href="admin-dashboard.html" class="active">Dashboard</a>
  <a href="#balances">Balances</a>
  <a href="#transactions">Transactions</a>
  <a href="#scheduled">Scheduled</a>
  <a href="#transfer">Fake Transfer</a>
  <a href="#register">Register User</a>
  <a href="#kyc">KYC Approvals</a>
  <a href="#users">User Management</a>
  <a href="#tickets">Support Tickets</a>
  <a href="#" id="logoutLink">Logout</a>
</div>

<div class="main">
  <div class="greeting">Welcome Admin</div>
  <div id="alertMessage" class="alert"></div>

  <!-- Balances -->
  <div class="panel" id="balances">
    <h3>üí∞ Account Balances</h3>
    <table id="balanceTable"><tr><td class="empty-state">Loading balances...</td></tr></table>
  </div>

  <!-- Transactions -->
  <div class="panel" id="transactions">
    <h3>üìë Transaction History</h3>
    <table id="transactionTable"><tr><td class="empty-state">Loading transactions...</td></tr></table>
  </div>

  <!-- Scheduled -->
  <div class="panel" id="scheduled">
    <h3>‚è≥ Scheduled Transactions</h3>
    <table id="scheduledTable"><tr><td class="empty-state">Loading scheduled...</td></tr></table>
  </div>

  <!-- Fake Transfer -->
  <div class="panel" id="transfer">
    <h3>üí∏ Fake Transfer</h3>
    <form id="transferForm">
      <input type="email" id="fromEmail" placeholder="From (Admin email)" required>
      <input type="email" id="toEmail" placeholder="To (User email)" required>
      <input type="number" id="amount" placeholder="Amount" required>
      <button type="submit">Transfer</button>
    </form>
  </div>

  <!-- Register User -->
  <div class="panel" id="register">
    <h3>üìù Register New User</h3>
    <form id="registerForm">
      <input type="text" id="regName" placeholder="Full Name" required>
      <input type="email" id="regEmail" placeholder="Email" required>
      <input type="password" id="regPassword" placeholder="Password" required>
      <input type="text" id="regType" placeholder="Account Type (checking/savings)" required>
      <button type="submit">Register User</button>
    </form>
  </div>

  <!-- Existing panels -->
  <div class="panel" id="kyc"><h3>üìã KYC Approvals</h3><table id="kycTable"><tr><td class="empty-state">Loading KYC...</td></tr></table></div>
  <div class="panel" id="users"><h3>üë• User Management</h3><table id="userTable"><tr><td class="empty-state">Loading users...</td></tr></table></div>
  <div class="panel" id="tickets"><h3>üé´ Support Tickets</h3><table id="ticketTable"><tr><td class="empty-state">Loading tickets...</td></tr></table></div>
</div>

<script>
function showAlert(message,type='error'){
  const el=document.getElementById('alertMessage');
  el.textContent=message; el.className=`alert alert-${type}`; el.style.display='block';
  if(type==='success') setTimeout(()=>el.style.display='none',4000);
}

// Load balances from localStorage (adminData)
function loadBalances(){
  const data=JSON.parse(localStorage.getItem('adminData')||'{}');
  const accounts=data.accounts||[];
  const table=document.getElementById('balanceTable');
  if(accounts.length>0){
    let html='<tr><th>Name</th><th>Email</th><th>Type</th><th>Account #</th><th>Balance</th></tr>';
    accounts.forEach(acc=>{
      html+=`<tr><td>${acc.fullName}</td><td>${acc.email}</td><td>${acc.accountType}</td><td>${acc.accountNumber}</td><td>$${acc.balance.toLocaleString()}</td></tr>`;
    });
    table.innerHTML=html;
  }else{ table.innerHTML='<tr><td colspan="5" class="empty-state">No accounts found</td></tr>'; }
}

// Fetch transactions live
async function loadTransactions(){
  try {
    const res = await fetch('http://localhost:5000/auth/transactions');
    const data = await res.json();
    const table = document.getElementById('transactionTable');

    if (res.ok && data.success && data.transactions.length > 0) {
      let html = '<tr><th>From</th><th>To</th><th>Amount</th><th>Date</th><th>Status</th></tr>';
      data.transactions.forEach(tx => {
        const dateStr = new Date(tx.date).toLocaleString();
        html += `<tr>
          <td>${tx.from}</td>
          <td>${tx.to}</td>
          <td>$${tx.amount}</td>
          <td>${dateStr}</td>
          <td>${tx.status}</td>
        </tr>`;
      });
      table.innerHTML = html;
    } else {
      table.innerHTML = '<tr><td colspan="5" class="empty-state">No transactions found</td></tr>';
    }
  } catch (err) {
    console.error('Transactions fetch error:', err);
    showAlert('Failed to load transactions');
  }
}

async function loadScheduled(){
  try {
    const res = await fetch('http://localhost:5000/auth/transactions');
    const data = await res.json();
    const table = document.getElementById('scheduledTable');

    if (res.ok && data.success) {
      const scheduled = data.transactions.filter(tx => tx.status === 'scheduled');
      if (scheduled.length > 0) {
        let html = '<tr><th>From</th><th>To</th><th>Amount</th><th>Date</th><th>Status</th></tr>';
        scheduled.forEach(tx => {
          const dateStr = new Date(tx.date).toLocaleString();
          html += `<tr>
            <td>${tx.from}</td>
            <td>${tx.to}</td>
            <td>$${tx.amount}</td>
            <td>${dateStr}</td>
            <td>${tx.status}</td>
          </tr>`;
        });
        table.innerHTML = html;
      } else {
        table.innerHTML = '<tr><td colspan="5" class="empty-state">No scheduled transactions</td></tr>';
      }
    }
  } catch (err) {
    console.error('Scheduled fetch error:', err);
    showAlert('Failed to load scheduled transactions');
  }
}

// Fake transfer form
document.getElementById('transferForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const fromEmail=document.getElementById('fromEmail').value;
  const toEmail=document.getElementById('toEmail').value;
  const amount=parseFloat(document.getElementById('amount').value);
  try{
    const res=await fetch('http://localhost:5000/auth/fake-transfer',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({fromEmail,toEmail,amount})
    });
    const data=await res.json();
    if(res.ok && data.success){
      showAlert(data.message,'success');
      loadBalances(); 
      loadTransactions(); 
    }else{
      showAlert(data.error||'Transfer failed');
    }
  }catch(err){
    console.error('Transfer error:',err);
    showAlert('Error connecting to server');
  }
});

// Register new user form
document.getElementById('registerForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const fullName=document.getElementById('regName').value;
  const email=document.getElementById('regEmail').value;
  const password=document.getElementById('regPassword').value;
  const accountType=document.getElementById('regType').value;
  try{
    const res=await fetch('http://localhost:5000/auth/register',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({fullName,email,password,accountType})
    });
    const data=await res.json();
    if(res.ok && data.success){
      showAlert('User registered successfully','success');
      document.getElementById('registerForm').reset();
      loadBalances(); 
    }else{
      showAlert(data.error||'Registration failed');
    }
  }catch(err){
    console.error('Register error:',err);
    showAlert('Error connecting to server');
  }
});

// Logout
document.getElementById('logoutLink').addEventListener('click',e=>{
  e.preventDefault(); localStorage.clear(); window.location.href='login.html';
});

// Init
document.addEventListener('DOMContentLoaded',()=>{
  const data=localStorage.getItem('adminData');
  if(!data){window.location.href='login.html';return;}
  loadBalances();
  loadTransactions();
  loadScheduled();
  // keep your existing loaders for analytics, KYC, users, tickets if backend endpoints exist
});
</script>

</body>
</html>
