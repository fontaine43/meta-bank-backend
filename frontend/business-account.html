<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Register Business Account – Meta Bank</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin:0; font-family:'Segoe UI',sans-serif;
      background:linear-gradient(to bottom right,#ffffff,#e0f7e9);
      min-height:100vh;
    }
    .navbar {
      background-color:#006644; color:white;
      display:flex; justify-content:space-between; align-items:center;
      padding:15px 30px; position:sticky; top:0; z-index:1000;
    }
    .navbar h1 { margin:0; font-size:1.8em; cursor:pointer; display:flex; align-items:center; gap:10px; }
    .navbar h1 img { height:40px; width:auto; border-radius:4px; }
    .navbar a { color:white; text-decoration:none; margin-left:15px; font-weight:500; }
    .navbar a.signup { background:#ffcc00; color:#003322; padding:8px 16px; border-radius:4px; }
    .page-wrapper { display:flex; justify-content:center; align-items:flex-start; padding:40px 20px; min-height:calc(100vh - 80px); }
    .form-card {
      background:white; padding:40px 30px; border-radius:12px;
      box-shadow:0 10px 30px rgba(0,0,0,0.1); max-width:600px; width:100%;
    }
    .form-card h2 { margin:0 0 30px; color:#006644; text-align:center; font-size:28px; }
    .form-group { margin-bottom:20px; }
    label { display:block; margin-bottom:8px; font-weight:600; color:#333; }
    input { width:100%; padding:12px 15px; border:2px solid #e1e5e9; border-radius:6px; font-size:16px; transition:border-color 0.3s; }
    input:focus { outline:none; border-color:#006644; }
    button {
      margin-top:20px; background-color:#006644; color:white;
      padding:14px 30px; border:none; border-radius:6px; cursor:pointer;
      width:100%; font-size:16px; font-weight:600; transition:background-color 0.3s;
    }
    button:hover { background-color:#004d33; }
    button:disabled { background-color:#ccc; cursor:not-allowed; }
    .alert { padding:12px 15px; border-radius:6px; margin-top:20px; text-align:center; font-weight:500; display:none; }
    .alert-success { background:#e8f8ef; color:#006644; border:1px solid #b8e6b8; }
    .alert-error { background:#ffeaea; color:#d63031; border:1px solid #ffcccc; }
    .loading { display:inline-block; width:20px; height:20px; border:3px solid #fff; border-radius:50%; border-top-color:transparent; animation:spin 1s ease-in-out infinite; margin-right:10px; }
    @keyframes spin { to { transform:rotate(360deg);} }
    .file-input { padding:15px; background:#f8f9fa; border:2px dashed #dee2e6; border-radius:6px; text-align:center; cursor:pointer; transition:border-color 0.3s; }
    .file-input:hover { border-color:#006644; }
    .file-input input { display:none; }
    .file-input label { cursor:pointer; margin:0; color:#666; }
    .file-name { margin-top:8px; font-size:14px; color:#006644; font-weight:500; }
  </style>
</head>
<body>

<div class="navbar">
  <h1 onclick="location.href='index.html'">
    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSDZeccWB2mKqtr0TRVnXSiTvQs9ky5mCKXqw&s" alt="Meta Bank Logo">
    Meta Bank
  </h1>
  <div>
    <a href="login.html">Login</a>
    <a href="register.html" class="signup">Sign Up</a>
  </div>
</div>

<div class="page-wrapper">
  <div class="form-card">
    <h2>Register Business Account</h2>
    <div id="alertMessage" class="alert"></div>

    <form id="businessForm">
      <div class="form-group"><label>Business Name</label><input type="text" name="businessName" required></div>
      <div class="form-group"><label>DBA (Doing Business As)</label><input type="text" name="dba" required></div>
      <div class="form-group"><label>EIN (Employer Identification Number)</label><input type="text" name="ein" required></div>
      <div class="form-group"><label>Business Address</label><input type="text" name="businessAddress" required></div>
      <div class="form-group"><label>Business Email</label><input type="email" name="businessEmail" required></div>
      <div class="form-group"><label>Business Phone</label><input type="tel" name="businessPhone" required></div>

      <div class="form-group">
        <label>Attach EIN Letter</label>
        <div class="file-input">
          <input type="file" name="einLetter" accept=".pdf,.jpg,.png,.jpeg" required>
          <label>Click to upload EIN Letter (PDF, JPG, PNG)</label>
          <div class="file-name"></div>
        </div>
      </div>

      <div class="form-group">
        <label>Attach Certificate or Articles of Organization</label>
        <div class="file-input">
          <input type="file" name="certOrArticles" accept=".pdf,.jpg,.png,.jpeg" required>
          <label>Click to upload Certificate (PDF, JPG, PNG)</label>
          <div class="file-name"></div>
        </div>
      </div>

      <button type="submit" id="submitButton">
        <span id="buttonText">Register Business Account</span>
        <span id="buttonSpinner" class="loading" style="display:none;"></span>
      </button>
    </form>
  </div>
</div>

<script>
const API_BASE =
  (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')
    ? 'http://localhost:5000/api'
    : 'https://meta-bank-backend.onrender.com/api';

function showAlert(message,type='error'){
  const el=document.getElementById('alertMessage');
  el.textContent=message; el.className=`alert alert-${type}`; el.style.display='block';
  if(type==='success') setTimeout(()=>el.style.display='none',4000);
}
function setLoading(isLoading){
  const btn=document.getElementById('submitButton');
  const txt=document.getElementById('buttonText');
  const spin=document.getElementById('buttonSpinner');
  if(isLoading){btn.disabled=true;txt.textContent='Registering...';spin.style.display='inline-block';}
  else{btn.disabled=false;txt.textContent='Register Business Account';spin.style.display='none';}
}
function checkAuth(){
  const token=localStorage.getItem('metaBankToken');
  if(!token){showAlert('Please log in first.');setTimeout(()=>window.location.href='login.html',2000);return false;}
  return true;
}

document.getElementById('businessForm').addEventListener('submit',async e=>{
  e.preventDefault();
  if(!checkAuth()) return;
  const token=localStorage.getItem('metaBankToken');
  setLoading(true);
  try{
    const formData=new FormData(e.target);
    const res=await fetch(`${API_BASE}/user/business-account`,{method:'POST',headers:{'Authorization':'Bearer '+token},body:formData});
    const data=await res.json();
    if(res.ok&&data.success){
      showAlert('✅ Business account registered successfully!','success');
      setTimeout(()=>window.location.href='dashboard.html',2000);
    }else{showAlert(data.message||'Failed to register business account');}
  }catch(err){console.error(err);showAlert('Error connecting to server');}
  finally{setLoading(false);}
});

// Update file labels
document.querySelectorAll('input[type="file"]').forEach(input=>{
  input.addEventListener('change',function(){
    const fileNameEl=this.parentElement.querySelector('.file-name');
    fileNameEl.textContent=this.files.length>0?this.files[0].name:'';
  });
});

// Verify token on load
document.addEventListener('DOMContentLoaded',()=>{
  if(!checkAuth()) return;
  const token=localStorage.getItem('metaBankToken');
  fetch(`${API_BASE}/auth/profile`,{headers:{'Authorization':'Bearer '+  fetch(`${API_BASE}/auth/profile`, {
    headers: { 'Authorization': 'Bearer ' + token }
  })
  .then(response => {
    if (!response.ok) {
      localStorage.removeItem('metaBankToken');
      localStorage.removeItem('metaBankUser');
      window.location.href = 'login.html';
    }
  })
  .catch(() => {
    localStorage.removeItem('metaBankToken');
    localStorage.removeItem('metaBankUser');
    window.location.href = 'login.html';
  });
});
</script>

</body>
</html>
